<?xml version="1.0" encoding="UTF-8"?>
<!-- Related XMLSchema file: conf/schemas/test.xsd -->

<test name="CORE" description="CORE regression tests">

    <parameter name="[speedTestcase]" operation="set" value="10000" description="number of testcase per second"   	    editable="true"/>	
    <parameter name="[TestDurationSec]" operation="set" value="36000" description="Duration (in sec.) of the test"   	    editable="true"/>
    
    <!-- parameter for monitoring testacse 902_system_monitor -->
    <parameter name="[interval]" operation="set" description="interval in sec between each vmstat result" value="1" editable="true"/>

    <parameter name="[nameServer]" operation="file.readCsv" value="./vmstat_servers.csv" value2="nameServer" />
    <parameter name="[IPServer]" operation="file.readCsv" value="./vmstat_servers.csv" value2="IPServer" />
    <parameter name="[login]" operation="file.readCsv" value="./vmstat_servers.csv" value2="login" />
    <parameter name="[passwd]" operation="file.readCsv" value="./vmstat_servers.csv" value2="passwd" />

    <parameter name="[nbServer]" operation="list.size" value="[nameServer]"/>   
    <parameter name="[nbServer]" operation="number.substract" value="[nbServer]" value2="1"/>
    
    <parameter name="[TestDurSecDiv10]" operation="number.divide" value="[TestDurationSec]" value2="10"/>   
    <parameter name="[TestDurSecDiv20]" operation="number.divide" value="[TestDurationSec]" value2="20"/>       
    
    <parameter name="[date]" operation="system.timestamp" value="1970"/>
    <parameter name="[date]" operation="number.toDate" value="[date]" value2="dd-MM-yy_HH-mm"/>

    <for index="[numServer]" from="0" to="[nbServer]" step="1">
    	<testcase name="monitoring [nameServer([numServer])]" state="true">
        	<parameter name="[csvFilename]" operation="set" value="vmstat_[interval]_[nameServer([numServer])]_[date].csv"/>
                <parameter name="[server]" operation="set" value="[IPServer([numServer])]"/>
                <parameter name="[login]" operation="set" value="[login([numServer])]"/>
                <parameter name="[passwd]" operation="set" value="[passwd([numServer])]"/>
                <parameter name="[nameserver]" operation="set" value="[nameServer([numServer])]"/>
                
                <runProfile>                
                	<step time="0" period="0"/>
                	<end delay="[TestDurationSec]"/>
                </runProfile>
                
                <scenario name="monitoring [nameServer([numServer])]">./monitor.xml</scenario>
	</testcase>
    </for>

    <testcase name="loading localhost" state="true">
              
	<runProfile>                
        	<step time="0" frequency="0"/>
                <step time="[TestDurSecDiv20]" frequency="[speedTestcase]"/>
                <step time="[TestDurSecDiv10]" frequency="0"/>
                <end delay="[TestDurationSec]"/>                
	</runProfile>
                
	<scenario name="loading localhost">./loading.xml</scenario>
    </testcase>

</test>
