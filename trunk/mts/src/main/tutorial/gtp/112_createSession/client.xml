<?xml version="1.0" encoding="UTF-8"?>

<!-- scenario client-->
<scenario>
    
    <parameter name="[testcase:sem1]" operation="system.semaphorewait" />
    
    <parameter name="[connection]" operation="set" value="connection" />
    <openChannelGTP name="[connection]" remoteHost="[serverRemoteIp(0)]" remotePort="3387"/>

    <parameter name="[tunnelEndpointId]" operation="set" value="0"/>
    <parameter name="[sequenceNumber]" operation="set" value="199"/>
    <sendMessageGTP name="send message" channel="[connection]">
        <headerV2 name="createSessionRequest" piggyFlag = "0" teidFlag = "1" tunnelEndpointId = "[tunnelEndpointId]" sequenceNumber="[sequenceNumber]"/>
        <element identifier="IMSI" coding="TLIV" description="International Mobile Subscriber Identity">
            <field name="IMSI" value="208014420002029" description="International Mobile Subscriber Identity"/>
        </element>
        <element identifier="MSISDN" coding="TLIV" description="Mobile Subscriber ISDN Number">
            <field name="MSISDN" value="33645432029" description="Mobile Subscriber ISDN Number"/>
        </element>
        <element identifier="MEI" coding="TLIV" description="Mobile Equipment Identity">
            <field name="MEI" value="9999000000001011" description="Mobile Equipment Identity"/>
        </element>        
        <element identifier="ULI" coding="TLIV" description="User Location Information">
            <field name="spare1" value="0"/>
            <field name="LAI" value="0"/>
            <field name="ECGI" value="1"/>
            <field name="TAI" value="1"/>
            <field name="RAI" value="0"/>
            <field name="SAI" value="0"/>
            <field name="CGI" value="0"/>
            <!-- TODO conditional field-->
            <field name="TAI_MMC1" value="214,03"/>
            <field name="TAI_Tracking Area Code" value="3"/>
            <field name="ECGI_MMC2" value="214,03"/>
            <field name="ECGI_spare2" value="0"/>
            <field name="ECGI_ECI" value="257"/>
        </element>
        <element identifier="AMBR" coding="TLIV" description="Aggregate Maximum Bit Rate">
            <field name="APN-AMBR for uplink" value="50000"/>
            <field name="APN-AMBR for downlink" value="100000"/>        
        </element>              
        <element identifier="Serving Network" coding="TLIV">
            <field name="MMC" value="214,03"/>
        </element>  
        <element identifier="RAT Type" coding="TLIV">
            <field name="RAT Type" value="EUTRAN"/>
        </element>
        <element identifier="F-TEID" coding="TLIV" description="Fully Qualified Tunnel Endpoint Identifier">
            <field name="V4" value="true"/>        
            <field name="V6" value="0"/>
            <field name="Interface Type" value="S5/S8 SGW GTP-C"/>
            <field name="TEID / GRE Key" value="17767" description="GRE?"/>
            <!-- TODO conditional IP V4 V6 -->
            <field name="IPv4 address" value="20.21.0.1"/>
            <!--field name="IPv6 address" value="1234:5678:90ab:cdef:fedc:ba09:8765:4321"/-->
        </element>
        <element identifier="Selection Mode" coding="TLIV">    
            <field name="spare" value="0"/>
            <field name="Selection Mode" value="MS provided APN, subscription not verified"/>
        </element>
        <element identifier="PDN Type" coding="TLIV">
            <field name="spare" value="0"/>
            <field name="PDN Type" value="IPv4"/>
        </element>
        <element identifier="PAA" coding="TLIV" description="PDN Address Allocation">
            <field name="spare" value="0"/>
            <field name="PDN Type" value="IPv4"/>
            <field name="IPv4 address" value="0.0.0.0"/>
        </element>                   
        <element identifier="APN" coding="TLIV" description="Access Point Name">
        		<field name="APN01" value="otarie" description="Access Point Name"/>
            <field name="APN02" value="mnc003" description="Access Point Name"/>
            <field name="APN03" value="mcc214" description="Access Point Name"/>                    		
            <field name="APN04" value="gprs" description="Access Point Name"/>            
        </element>      
        <!--element identifier="Indication" coding="TLIV">
            <field name="DAF" value="0"/>
            <field name="DTF" value="0"/>
            <field name="HI" value="0"/>
            <field name="DFI" value="0"/>         
            <field name="OI" value="0"/>
            <field name="ISRSI" value="0"/>
            <field name="ISRAI" value="0"/>                                                  
            <field name="SGWCI" value="0"/>
    
            <field name="SQCI" value="0"/>  
            <field name="UIMSI" value="0"/>
            <field name="CFSI" value="0"/>
            <field name="CRSI" value="1"/>
            <!-field name="P" value="0"/>
            <field name="PT" value="1"/>
            <field name="TDI" value="0"/>
            <field name="SI" value="0"/>
            <field name="MSV" value="0"/>
    
            <field name="RetLoc" value="0"/>
            <field name="PBIC" value="0"/>
            <field name="SRNI" value="0"/>
            <field name="S6AF" value="0"/>
            <field name="S4AF" value="0"/>
            <field name="MBMDT" value="0"/>
            <field name="SRAU" value="0"/>
            <field name="CCRSI" value="0"/>
            
            <!-field name="Spare" value="0"/>
            <field name="CLII" value="0"/>
            <field name="CPSR" value="0"/>        
        </element-->
        <element identifier="APN Restriction" coding="TLIV">
            <field name="Restriction Type value" value="No Existing Contexts or Restriction"/>
        </element>                      
        <!--element identifier="PCO" coding="TLIV" description="Protocol Configuration Options">
        		<field name="PCO" value="8080211001000010810600000000830600000000000d00000a00" description="Protocol Configuration Options"/>
        </element-->
        <element identifier="Bearer Context" coding="TLIV">
            <element identifier="EBI" coding="TLIV" description="EPS Bearer ID">
                <field name="spare" value="0"/>              
            		<field name="EBI" value="5"/>
            </element>
            <element identifier="Bearer QoS" coding="TLIV" description="Bearer Quality of Service">
                <field name="spare1" value="0"/>
                <field name="PCI" value="true" description="Pre-emption Capability"/>        
                <field name="PL" value="2" description="Priority Level"/>
                <field name="spare2" value="false" type="boolean"/>        
                <field name="PVI" value="0" description="Pre-emption Vulnerability"/>
                <field name="Label QCI" value="9"/>                
                <field name="Maximum bit rate for uplink" value="0"/>
                <field name="Maximum bit rate for downlink" value="0"/>
                <field name="Guaranteed bit rate for uplink" value="0"/>
                <field name="Guaranteed bit rate for downlink" value="0"/>                        
            </element>            
            <element identifier="F-TEID" instances="2" coding="TLIV" description="Fully Qualified Tunnel Endpoint Identifier">
                <field name="V4" value="1"/>        
                <field name="V6" value="false"/>
                <field name="Interface Type" value="S5/S8 SGW GTP-U"/>
                <field name="TEID / GRE Key" value="17775" description="GRE key ?"/>
                <!-- TODO conditional IP V4 V6 -->      
                <field name="IPv4 address" value="20.21.0.1"/>
                <!--field name="IPv6 address" value="1212:1234:1256:1278:1290:12ab:12cd:12ef"/-->
            </element>
        </element>
        <!--element identifier="UE Time Zone" coding="TLIV">
            <field name="Time Zone" value="64"/>   
            <field name="spare" value="0"/>
            <field name="Daylight Saving Time" value="No adjustment for Daylight Saving Time"/>
        </element-->
       <!--element identifier="Charging Characteristics" coding="TLIV">
            <field name="Charging Characteristics value" value="2048"/>   
      </element-->        
    </sendMessageGTP>

    <receiveMessageGTP name="receive message">
        <parameter name="[channel]" operation="protocol.setFromMessage" value="channel.name"/>
        <parameter name="[seqNum]" operation="protocol.setFromMessage" value="header.sequenceNumber"/>
        <parameter name="[tunnelEndpointId]" operation="protocol.setFromMessage" value="header.tunnelEndpointId"/>             
    </receiveMessageGTP>

    <parameter name="[binary]" operation="protocol.setFromMessage" value="message.binary"/>  
    <test parameter="[binary]" condition="binary.equals" value="48210052000045670000c7000200020010005700090187a7d42066ac14462b4f00050001141401027f000100005d002000490001000502000200100057000902859e974066ac14462b5e00040021bd56390300010048"/>

    <pause name="call duration" seconds="1"/>
    
    <parameter name="[tunnelEndpointId]" operation="set" value="0"/>
    <parameter name="[sequenceNumber]" operation="set" value="199"/>
    <sendMessageGTP name="send message" channel="[connection]">
        <headerV2 name="deleteSessionRequest" piggyFlag = "0" teidFlag = "1" tunnelEndpointId = "[tunnelEndpointId]" sequenceNumber="[sequenceNumber]"/>
        <element identifier="EBI" coding="TLIV" description="EPS Bearer ID">
            <field name="spare" value="0"/>              
        		<field name="EBI" value="5"/>
        </element>              
        <element identifier="Indication" coding="TLIV">
            <field name="DAF" value="0"/>
            <field name="DTF" value="0"/>
            <field name="HI" value="0"/>
            <field name="DFI" value="0"/>         
            <field name="OI" value="0"/>
            <field name="ISRSI" value="0"/>
            <field name="ISRAI" value="0"/>                                                  
            <field name="SGWCI" value="0"/>
    
            <field name="SQCI" value="0"/>  
            <field name="UIMSI" value="0"/>
            <field name="CFSI" value="0"/>
            <field name="CRSI" value="1"/>
            <!--field name="P" value="0"/-->
            <field name="PT" value="1"/>
            <field name="TDI" value="0"/>
            <field name="SI" value="0"/>
            <field name="MSV" value="0"/>
    
            <field name="RetLoc" value="0"/>
            <field name="PBIC" value="0"/>
            <field name="SRNI" value="0"/>
            <field name="S6AF" value="0"/>
            <field name="S4AF" value="0"/>
            <field name="MBMDT" value="0"/>
            <field name="SRAU" value="0"/>
            <field name="CCRSI" value="0"/>
            
            <!--field name="Spare" value="0"/>
            <field name="CLII" value="0"/>
            <field name="CPSR" value="0"/-->        
        </element>
    </sendMessageGTP>

    <receiveMessageGTP name="receive message">
        <parameter name="[channel]" operation="protocol.setFromMessage" value="channel.name"/>
        <parameter name="[seqNum]" operation="protocol.setFromMessage" value="header.sequenceNumber"/>
        <parameter name="[tunnelEndpointId]" operation="protocol.setFromMessage" value="header.tunnelEndpointId"/>             
    </receiveMessageGTP>

    <parameter name="[binary]" operation="protocol.setFromMessage" value="message.binary"/>  
    <!--test parameter="[binary]" condition="binary.equals" value="48210052000045670000c7000200020010005700090187a7d42066ac14462b4f00050001141401027f000100005d002000490001000502000200100057000902859e974066ac14462b5e00040021bd56390300010048"/-->

    <finally>
        <closeChannelGTP name="[connection]"/>
    </finally>
    
</scenario>
