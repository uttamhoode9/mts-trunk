<?xml version="1.0" encoding="UTF-8"?>
<!-- Related XMLSchema file: conf/schemas/scenario.xsd -->
<!DOCTYPE Library [
  <!ENTITY register    SYSTEM "../Library\register_provider.xml">
 ]>

<scenario>
	<parameter name="[clientName]" operation="set" value="[client_UAS]"/>
	<parameter name="[clientName2]" operation="set" value="[client_UAC]"/>
	<parameter name="[100_DOMAIN_ADDR]" operation="set" value="[domaine]"/>
	
	<parameter name="[LocalHost]" operation="setFromSystem" value="IPAddress" value2="eth0"/>
	<parameter name="[LocalPort]" operation="set" value="[port_UAS2]"/>
	<parameter name="[LocalAddress]" operation="set" value="[LocalHost(0)]:[LocalPort(0)]"/>	
	<parameter name="[LocalTransport]" operation="set" value="udp"/>  
	
	<openProviderSIP name="open SIP provider" providerName="[scenarioName]" localPort="[LocalPort(0)]" transport="[LocalTransport]"/>
	
	
		<parameter name="[testcase:SEM2]" operation="system.semaphorewait"/>
	
		<parameter name="[Expires]" 		operation="set" value="3600"/>
		<parameter name="[provider]" 		operation="set" value="[scenarioName]"/>
	
	&register;
		
		
	<parameter name="[testcase:SEM3]" operation="system.semaphorenotify"/>
	
	<receiveRequestSIP name="Wait INVITE"  method="INVITE">
	<parameter name="[lastTo]" 			operation="setFromMessage" 	value="header:To"/>       
    <parameter name="[lastFrom]" 		operation="setFromMessage" 	value="header:From"/>   
    <parameter name="[lastCallId]"		operation="setFromMessage" 	value="header:Call-Id"/>
    <parameter name="[lastCseq]"		operation="setFromMessage" 	value="header:CSeq"/>
    <parameter name="[lastVia]" 		operation="setFromMessage" 	value="header:Via"/>
    <parameter name="[contact]"		 	operation="setFromMessage" 	value="header:Contact"/>
    <parameter name="[MaxForwards]" 	operation="setFromMessage" 	value="header:Max-Forwards"/>
    <parameter name="[localTag]" 		operation="identifier" 		value="newString" value2="10"/>
	<parameter name="[Record-Route]" 	operation="setFromMessage" 	value="header:Record-Route"/>
    </receiveRequestSIP>
	<parameter name="[testcase:SEM16]" operation="system.semaphorenotify"/>
	<parameter name="[testcase:SEM16]" operation="system.semaphorenotify"/>
	<parameter name="[testcase:SEM15]" operation="system.semaphorewait"/>
	<parameter name="[testcase:SEM17]" operation="system.semaphorewait"/>
	
	
	
<parameter name="[testcase:SEM20]" operation="system.semaphorewait"/>

<sendResponseSIP name="Send 486 Busy Here" providerName="[scenarioName]">
<![CDATA[SIP/2.0 486 Busy Here
To: [lastTo];tag=[localTag]
From: [lastFrom]
Via: [lastVia]
Call-ID: [lastCallId]
CSeq: [lastCseq]
P-Access-Network-Info: 3GPP-UTRAN-TDD; utran-cell-id-3gpp=00000000
User-Agent: [UserAgent]
Content-Length: 0
]]>
 </sendResponseSIP>

  <receiveRequestSIP name="Wait ACK" method="ACK">
  </receiveRequestSIP>
  
<parameter name="[testcase:SEM13]" operation="system.semaphorenotify"/>

<parameter name="[testcase:SEM8]" operation="system.semaphorewait"/>
 
<finally>  

    <parameter name="[Expires]" 		operation="set" value="0"/>
		
	&register;
	
	<parameter name="[testcase:SEM9]" operation="system.semaphorenotify"/>
   
 </finally> 
 
</scenario>	