<?xml version="1.0" encoding="UTF-8"?>

<test name="MSRP regression tests">

    <parameter name="[speedTrans]" operation="set" value="10000" description="number of transaction per second"   		editable="true"/>	
    <parameter name="[TestDurationSec]" operation="set" value="360000" description="Duration (in sec.) of the test"   	    	editable="true"/>
    <parameter name="[NumberTestcase]" operation="set" value="10" description="number of testcase"   			        editable="true"/>
    <parameter name="[ContentSize]" operation="set" value="1000" description="size of the HTTP message"   			editable="true"/>
    
    <!--
       - URL of the HTTP server.
     -->
    <parameter name="[remoteHost]" operation="system.ipaddress"/>
    <parameter name="[remoteHost]" operation="set" value="[remoteHost(0)]"/>
    <parameter name="[remotePort]" operation="file.readProperty" value="msrp.properties" value2="listenpoint.LOCAL_PORT"/>
    <parameter name="[remoteURL]" operation="set" value="http://[remoteHost]:[remotePort]" />
    <parameter name="[transport]" operation="set" value="TCP" />
    
    <parameter name="[speedTestcase]" operation="number.divide" value="[speedTrans]" value2="[NumberTestcase]"/>	    

    <parameter name="[iter]" operation="number.divide" value="[ContentSize]" value2="10"/>
    <parameter name="[content]" operation="set" value="0123465789" value2="[iter]"/>

    <!--
       - Scenario of the server.
       - This server will always answer 200 OK.
       - It never ends since it is in a <while> operation.
       -->
    <testcase name="server" description="test post" state="false">

        <!--                       -->
        <!-- RUNPROFILE PARAMETERS -->
        <!--                       -->    
        <runProfile>
            <step time="0" period="0"/>
            <end delay="[TestDurationSec]"/>
        </runProfile>

        <scenario name="server">server.xml</scenario>
    </testcase>

    <for index="[i]" from="0" to="[NumberTestcase]">
        <testcase name="client_[i]" description="test post" state="true">
            <parameter name="[destScenario]" operation="set" value="server_[i]" />

            <!--                       -->
            <!-- RUNPROFILE PARAMETERS -->
            <!--                       -->    
            <runProfile>
                <step time="0" frequency="[speedTestcase]"/>
                <end delay="[TestDurationSec]"/>
            </runProfile>

            <scenario name="server_[i]">server.xml</scenario>
            <scenario name="client_[i]">client.xml</scenario>
        </testcase>
    </for>

</test>
