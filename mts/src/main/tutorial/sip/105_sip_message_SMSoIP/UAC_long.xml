<?xml version="1.0" encoding="UTF-8"?>
<!-- Related XMLSchema file: conf/schemas/scenario.xsd -->
<!-- useful link to check message encoding http://www.smartposition.nl/resources/sms_pdu.html -->
<!-- wireshark is able to decode the message and to show in a readable way -->

<scenario>

    <function file="105_sip_message_SMSoIP/library_UAC.xml"/>

    <parameter name="[smsText1]" operation="string.random" value="[smsTextLength]"/>
    <parameter name="[smsText1]" operation="set" value="[smsText]"/>
    <parameter name="[smsTextLength1]" operation="string.length" value="[smsText1]"/>
        
    <parameter name="[index]" operation="set" value="0"/>
    <while>
      <condition>
        <test parameter="[index]" condition="number.lowerThan" value="[smsTextLength]"/>
      </condition>
      <do>
        <parameter name="[fin]" operation="number.add" value="[index]" value2="[smsTextLengthMax]"/>
        <parameter name="[smsTextPartial]" operation="string.substring" value="[smsText1]" value2="[index]" value3="[fin]"/>
        
        <parameter name="[testcase:smsBinary]" operation="string.toBinary" value="[smsTextPartial]" value2="[smsAlphabet]"/>
        <parameter name="[concatSM_referenceNumber]" operation="binary.random" value="2"/>
        <!--parameter name="[concatSM_maximumNumberSM]" operation="number.divide" value="[smsTextLength1]" value2="[smsTextLengthMax]"/>
        <parameter name="[concatSM_maximumNumberSM]" operation="number.add" value="[concatSM_maximumNumberSM]" value2="1"/>
        <parameter name="[concatSM_maximumNumberSM]" operation="number.toBinary" value="[concatSM_maximumNumberSM]"/--> 
        <parameter name="[concatSM_maximumNumberSM]" operation="set" value="01"/>
        <parameter name="[concatSM_currentSM]" operation="set" value="01"/>
        <parameter name="[testcase:smsBinary]" operation="set" value="060804[concatSM_referenceNumber][concatSM_maximumNumberSM][concatSM_currentSM][smsBinary]"/>
        
        <parameter name="[testcase:smsTextLength]" operation="string.length" value="[smsTextPartial]"/>
        <parameter name="[testcase:smsTextLength]" operation="number.add" value="[testcase:smsTextLength]" value2="7"/>
        
      	<call name="send_message" >
          <input>
              <parameter name="[function:smsTextLength]" value="[smsTextLength]"/>
              <parameter name="[function:smsBinary]" value="[smsBinary]"/>
          </input>
        </call>
        
        <parameter name="[index]" operation="set" value="[fin]"/>
        
      </do>
    </while>
          
</scenario>
