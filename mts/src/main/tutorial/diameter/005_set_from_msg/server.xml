<?xml version="1.0" encoding="UTF-8"?>
<!-- Related XMLSchema file: conf/schemas/scenario.xsd -->
<!-- name="Send 3GPP CX Multimedia Authentication answer (MAR/MAA)" -->

<scenario>

     <pause name="pause" seconds="1" />
    
    <receiveMessageDIAMETER name="ReceiveRequestMAR" request="true" type="Multimedia-Authentitcation:506">
		<parameter name="[hopByHop]" operation="protocol.setFromMessage" value="header.hopByHop"/>    
		<parameter name="[endToEnd]" operation="protocol.setFromMessage" value="header.endToEnd"/>
    </receiveMessageDIAMETER>

    <parameter name="[listenpointName]" operation="protocol.setFromMessage" value="listenpoint.name"/>
    <test parameter="[listenpointName]" condition="list.isEmpty"/>
    <parameter name="[listenpointHost]" operation="protocol.setFromMessage" value="listenpoint.localHost"/>        
    <test parameter="[listenpointHost]" condition="string.equals" value="0.0.0.0"/>
    <parameter name="[listenpointPort]" operation="protocol.setFromMessage" value="listenpoint.localPort"/>    
    <test parameter="[listenpointPort]" condition="string.equals" value="[Local-Port]"/>
    <parameter name="[request1]" operation="protocol.setFromMessage" value="header.request"/>        
    <test parameter="[request1]" condition="string.equals" value="true"/>    
    <parameter name="[request2]" operation="protocol.setFromMessage" value="message.request"/>    
    <test parameter="[request2]" condition="string.equals" value="true"/>
    <parameter name="[type]" operation="protocol.setFromMessage" value="message.type"/>    
    <test parameter="[type]" condition="string.equals" value="Multimedia-Authentitcation:506"/>    
    <parameter name="[code]" operation="protocol.setFromMessage" value="header.command"/>    
    <test parameter="[code]" condition="string.equals" value="506"/>    
    <parameter name="[error]" operation="protocol.setFromMessage" value="header.error"/>    
    <test parameter="[error]" condition="string.equals" value="false"/>        
    <parameter name="[appId]" operation="protocol.setFromMessage" value="header.applicationId"/>    
    <test parameter="[appId]" condition="string.equals" value="16777216"/>    
    <parameter name="[proxiable]" operation="protocol.setFromMessage" value="header.proxiable"/>    
    <test parameter="[proxiable]" condition="string.equals" value="true"/>
    <parameter name="[retransmit]" operation="protocol.setFromMessage" value="header.retransmit"/>    
    <test parameter="[retransmit]" condition="string.equals" value="false"/>
    <parameter name="[protocol]" operation="protocol.setFromMessage" value="message.protocol"/>    
    <test parameter="[protocol]" condition="string.equals" value="DIAMETER"/>
    <parameter name="[avp1value]" operation="protocol.setFromMessage" value="avp.1018.1024.value"/>    
    <test parameter="[avp1value]" condition="string.equals" value="h49 h4e h56 h49 h54 h45 "/>
    <parameter name="[avp2value]" operation="protocol.setFromMessage" value="avp.283.value"/>        
    <test parameter="[avp2value]" condition="string.equals" value="[Remote-Realm]"/>
    <parameter name="[avp2vendor]" operation="protocol.setFromMessage" value="avp.283.vendorId"/>    
    <test parameter="[avp2vendor]" condition="string.equals" value="0"/>

    <sendMessageDIAMETER name="SendAnswerMAA">
	<header request="false" command="Multimedia-Authentitcation" applicationId="4321" proxiable="true" hopByHop="[hopByHop]" endToEnd="[endToEnd]"/>
	<avp code="Origin-Host" value="[Remote-Host]"/>
	<avp code="Origin-Realm" value="[Remote-Realm]"/>
	<avp code="Vendor-Specific-Application-Id">
		<avp code="Vendor-Id" value="10415"/>
		<avp code="Auth-Application-Id" value="16777216"/>
	</avp>
	<avp code="Session-Id" value="CXCSCFCX.sip.pfdev.fr;45e45ee4;046725;5cd579ef"/>
	<avp code="Auth-Session-State" value="NO_STATE_MAINTAINED"/>
	<avp code="Result-Code" value="2001"/>		
	<avp code="Public-Identity" value="sip:+33875631975@sip.pfdev.fr"/>
	<avp code="Number-Authentication-Items" value="1"/>
	<avp code="Auth-Data-Item">
	        <avp code="Item-Number" value="0"/>
	        <avp code="Authentication-Scheme" value="DIGEST"/>
	        <avp code="Authenticate" value='Digest username=\"33875631975@sip.pfdev.fr\",realm=\"sip.pfdev.fr\",cnonce=\"40b18ccf\",nc=00000001,qop=auth,uri=\"sip:sip.pfdev.fr\",nonce=\"21bc27679ddac8fd6c0088817c8ae385\",response=\"38179d99cc34ce0ad002ac4d70e37c0a\",algorithm=MD5'/>
	        <avp code="Authentication-Context" value="INVITE"/>
	</avp>
    </sendMessageDIAMETER>
    
</scenario>
